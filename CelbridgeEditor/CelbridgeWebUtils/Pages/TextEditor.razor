@page "/editor"
@layout FullPageLayout
@inject IJSRuntime JS

<PageTitle>Text Editor</PageTitle>

<StandaloneCodeEditor @ref="_editor"
                      Id="text-editor"
                      ConstructionOptions="EditorConstructionOptions"
                      CssClass="editor-viewport"
                      OnDidChangeModelContent="EditorDidChangeModelContent" />

@code {

    private static StandaloneCodeEditor _editor = null!;

    private StandaloneEditorConstructionOptions EditorConstructionOptions(StandaloneCodeEditor editor)
    {
        return new StandaloneEditorConstructionOptions
            {
                AutomaticLayout = true,
                Language = "markdown",
                Minimap = new EditorMinimapOptions
                {
                    Enabled = false
                },
                Theme = "vs-dark",
                MatchBrackets = "never",
            };
    }

    private void EditorDidChangeModelContent(ModelContentChangedEvent eventArgs)
    {
        async Task SendUpdatedText()
        {
            var content = await _editor.GetValue();
            await JS.InvokeVoidAsync("updateTextData", content);            
        }

        _ = SendUpdatedText();
    }

    [JSInvokable]
    public static async Task<string> SetTextData(string text)
    {
        await _editor.SetValue(text);
        return $"text was updated";
    }
}